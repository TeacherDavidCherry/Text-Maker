<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dynamic Input Width Based on Placeholder & Input</title>
<style>
  body {
    font-family: sans-serif;
    max-width: 95vw;
    margin: 40px auto;
    padding: 20px;
    background: #f9fbff;
    border-radius: 10px;
    border: 1px solid #ccc;
  }
  h2 {
    color: #333;
    margin: 0 15px 0 0;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .builder-section {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 20px;
  }
  input[type="text"] {
    font-size: 16px;
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: content-box;
    min-width: 2ch;
    max-width: 30ch;
    width: auto;
    transition: width 0.15s ease;
    font-family: inherit;
    autocapitalize: off;
  }
  #punctuation {
    width: 4ch !important;
    font-size: 24px;
    text-align: center;
    flex-grow: 0;
    flex-shrink: 0;
    box-sizing: content-box;
  }
  .plus {
    font-weight: bold;
    font-size: 20px;
    user-select: none;
    flex-shrink: 0;
  }
  button {
    padding: 6px 10px;
    font-size: 16px;
    border: none;
    background-color: #4a90e2;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    flex-shrink: 0;
    margin-left: 6px;
    white-space: nowrap;
  }
  button:hover {
    background-color: #357abd;
  }
  #builtAll {
    font-size: 18px;
    width: 50%;
    min-width: 300px;
    height: auto;
    min-height: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: #fff;
    box-sizing: border-box;
    resize: both;
    font-family: inherit;
    color: #222;
    white-space: pre-wrap;
    margin-top: 8px;
    overflow: hidden; /* prevent scrollbars */
  }
  #widthCalc {
    position: absolute;
    visibility: hidden;
    white-space: nowrap;
    font-size: 16px;
    font-family: inherit;
    padding: 6px 8px;
    border: 1px solid transparent;
    box-sizing: content-box;
  }
  .shirt-iep-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }
  .shirt-iep-container input[type="text"] {
    min-width: 17ch;
    max-width: 17ch;
  }
  .shirt-iep-separator {
    user-select: none;
    font-weight: bold;
    font-size: 18px;
  }
  #sessionDate {
    min-width: 17ch;
    max-width: 17ch;
  }
  .lineBreakBtn {
    background-color: #4a90e2;
    margin-left: 6px;
    padding: 6px 10px;
    font-size: 16px;
    border-radius: 4px;
  }
  .lineBreakBtn:hover {
    background-color: #666;
  }
  #copyBtn {
    background-color: #4a90e2;
    margin-left: 10px;
    margin-top: 8px;
  }
  #copyBtn:hover {
    background-color: #1e7e34;
  }
</style>
</head>
<body>

<div class="shirt-iep-container" aria-label="Shirt Number, IEP Group Number, and Date">
  <input id="shirtNumber" type="text" placeholder="Shirt Number" aria-label="Shirt Number" autocapitalize="off" />
  <input id="iepGroupNumber" type="text" placeholder="IEP Group Number" aria-label="IEP Group Number" autocapitalize="off" />
  <input id="sessionDate" type="text" placeholder="Date" aria-label="Date (optional)" autocapitalize="off" />
  <button id="buildHeaderBtn" title="Build Header">Build</button>
</div>

<div class="builder-section" aria-label="Sentence builder">
  <h2>Sentence:</h2>
  <input id="adverb1" type="text" placeholder="adverb" />
  <input id="noun" type="text" placeholder="noun" />
  <input id="negation" type="text" placeholder="negation" />
  <input id="adverbBetweenNegVerb" type="text" placeholder="adverb" />
  <input id="verb" type="text" placeholder="verb" />
  <input id="adverb2" type="text" placeholder="adverb" />
  <input id="object" type="text" placeholder="object" />
  <input id="subjectComplement" type="text" placeholder="subject complement" />
  <input id="adverb3" type="text" placeholder="adverb" />
  <input id="punctuation" type="text" placeholder=".,!" maxlength="1" />
  <input id="joiner" type="text" placeholder="joiner" />
  <button id="buildBtn">Build on same line</button>
  <button class="lineBreakBtn">Build on next line</button>
</div>

<div class="builder-section" aria-label="Yes/No question builder">
  <h2>Yes/No Question:</h2>
  <input id="auxVerb" type="text" placeholder="be/do/can/have" />
  <input id="auxSubject" type="text" placeholder="subject" />
  <input id="auxAdverbBeforeVerb" type="text" placeholder="adverb" />
  <input id="auxVerb2" type="text" placeholder="verb" />
  <input id="auxObject" type="text" placeholder="object" />
  <input id="auxSubjectComplement" type="text" placeholder="subject complement" />
  <input id="auxAdverb" type="text" placeholder="adverb" />
  <input id="auxQM" type="text" placeholder="?" maxlength="1" style="width: 2ch; text-align:center;" />
  <button id="buildYesNoQuestionBtn">Build on same line</button>
  <button class="lineBreakBtn">Build on next line</button>
</div>

<div class="builder-section" aria-label="WH question builder">
  <h2>WH- Question:</h2>
  <input id="whWord" type="text" placeholder="who/what/where/when/why/how" />
  <input id="whSubject" type="text" placeholder="subject" />
  <input id="whAdverbBetweenSubjectVerb" type="text" placeholder="adverb" />
  <input id="whVerb" type="text" placeholder="verb" />
  <input id="whObject" type="text" placeholder="object" />
  <input id="whSubjectComplement" type="text" placeholder="subject complement" />
  <input id="whAdverb" type="text" placeholder="adverb" />
  <input id="whQM" type="text" placeholder="?" maxlength="1" style="width: 2ch; text-align:center;" />
  <button id="buildWhQuestionBtn">Build on same line</button>
  <button class="lineBreakBtn">Build on next line</button>
</div>

<div style="display: flex; align-items: flex-start; gap: 10px; flex-wrap: wrap;">
  <h2>Rough Draft:</h2>
  <textarea id="builtAll" aria-label="Rough draft output"></textarea>
  <button id="copyBtn">Copy</button>
</div>

<span id="widthCalc" aria-hidden="true"></span>

<script>
  let headerBuilt = false;

  function adjustWidth(el) {
    const span = document.getElementById('widthCalc');
    span.style.font = window.getComputedStyle(el).font;
    span.textContent = el.value || el.placeholder || '';
    let width = span.offsetWidth + 20;
    if (width < 35) width = 35;
    el.style.width = width + 'px';
  }

  function autoResizeTextarea() { // <-- NEW
    const textarea = document.getElementById('builtAll');
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
  }

  function clearInputs(ids) {
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.value = '';
        adjustWidth(el);
      }
    });
  }

  function joinParts(parts) {
    if (parts.length === 0) return '';
    let result = parts[0];
    for (let i = 1; i < parts.length; i++) {
      if (/^[.,!?]$/.test(parts[i])) {
        result += parts[i];
      } else {
        result += ' ' + parts[i];
      }
    }
    return result;
  }

  document.querySelectorAll('input[type="text"]').forEach(input => {
    adjustWidth(input);
    input.addEventListener('input', () => adjustWidth(input));
  });

  function appendToBuiltAll(text, addLineBreak) { // <-- CHANGED
    const built = document.getElementById('builtAll');
    if (built.value) {
      built.value += addLineBreak ? '\n' + text : (built.value.endsWith('\n') ? text : ' ' + text);
    } else {
      built.value = text;
    }
    autoResizeTextarea(); // <-- NEW
  }

  document.getElementById('buildHeaderBtn').addEventListener('click', () => {
    if (headerBuilt) return;
    const shirt = document.getElementById('shirtNumber').value.trim();
    const iep = document.getElementById('iepGroupNumber').value.trim();
    const date = document.getElementById('sessionDate').value.trim();
    const headerParts = [shirt, iep, date].filter(Boolean);
    if (headerParts.length > 0) {
      const headerStr = headerParts.join(' | ');
      const built = document.getElementById('builtAll');
      built.value += (built.value ? '\n\n' : '') + headerStr + '\n\n';
      headerBuilt = true;
      document.getElementById('buildHeaderBtn').disabled = true;
      autoResizeTextarea(); // <-- NEW
    }
  });

  document.getElementById('buildBtn').addEventListener('click', () => {
    const inputs = ['adverb1', 'noun', 'negation', 'adverbBetweenNegVerb', 'verb', 'adverb2', 'object', 'subjectComplement', 'adverb3', 'punctuation', 'joiner'];
    const parts = inputs.map(id => document.getElementById(id).value.trim()).filter(Boolean);
    appendToBuiltAll(joinParts(parts), false);
    clearInputs(inputs);
  });

  document.querySelectorAll('.builder-section')[0].querySelector('.lineBreakBtn').addEventListener('click', () => {
    const inputs = ['adverb1', 'noun', 'negation', 'adverbBetweenNegVerb', 'verb', 'adverb2', 'object', 'subjectComplement', 'adverb3', 'punctuation', 'joiner'];
    const parts = inputs.map(id => document.getElementById(id).value.trim()).filter(Boolean);
    appendToBuiltAll(joinParts(parts), true);
    clearInputs(inputs);
  });

  function buildYesNoQuestion(addLineBreak) {
    const inputs = ['auxVerb', 'auxSubject', 'auxAdverbBeforeVerb', 'auxVerb2', 'auxObject', 'auxSubjectComplement', 'auxAdverb', 'auxQM'];
    const parts = inputs.map(id => document.getElementById(id).value.trim()).filter(Boolean);
    appendToBuiltAll(joinParts(parts), addLineBreak);
    clearInputs(inputs);
  }

  document.getElementById('buildYesNoQuestionBtn').addEventListener('click', () => buildYesNoQuestion(false));
  document.querySelectorAll('.builder-section')[1].querySelector('.lineBreakBtn').addEventListener('click', () => buildYesNoQuestion(true));

  function buildWhQuestion(addLineBreak) {
    const inputs = ['whWord', 'whSubject', 'whAdverbBetweenSubjectVerb', 'whVerb', 'whObject', 'whSubjectComplement', 'whAdverb', 'whQM'];
    const parts = inputs.map(id => document.getElementById(id).value.trim()).filter(Boolean);
    appendToBuiltAll(joinParts(parts), addLineBreak);
    clearInputs(inputs);
  }

  document.getElementById('buildWhQuestionBtn').addEventListener('click', () => buildWhQuestion(false));
  document.querySelectorAll('.builder-section')[2].querySelector('.lineBreakBtn').addEventListener('click', () => buildWhQuestion(true));

  document.getElementById('copyBtn').addEventListener('click', () => {
    const textArea = document.getElementById('builtAll');
    textArea.select();
    textArea.setSelectionRange(0, 99999);
    try {
      document.execCommand('copy');
      alert('Copied to clipboard!');
    } catch (err) {
      alert('Copy failed. Please copy manually.');
    }
    window.getSelection().removeAllRanges();
  });

  autoResizeTextarea(); // <-- NEW
</script>

</body>
</html>

