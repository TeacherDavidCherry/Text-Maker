<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dynamic Input Width Based on Placeholder & Input</title>
<style>
  body {
    font-family: sans-serif;
    max-width: 95vw;
    margin: 40px auto;
    padding: 20px;
    background: #f9fbff;
    border-radius: 10px;
    border: 1px solid #ccc;
  }
  h2 {
    color: #333;
    margin: 0 15px 0 0;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .builder-section {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 20px;
  }
  input[type="text"] {
    font-size: 16px;
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: content-box;
    min-width: 2ch;
    max-width: 30ch;
    width: auto;
    transition: width 0.15s ease;
    font-family: inherit;
    autocapitalize: off;
  }
  #punctuation {
    width: 4ch !important;
    font-size: 24px;
    text-align: center;
    flex-grow: 0;
    flex-shrink: 0;
    box-sizing: content-box;
  }
  .plus {
    font-weight: bold;
    font-size: 20px;
    user-select: none;
    flex-shrink: 0;
  }
  button {
    padding: 6px 10px;
    font-size: 16px;
    border: none;
    background-color: #4a90e2;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    flex-shrink: 0;
    margin-left: 6px;
    white-space: nowrap;
  }
  button:hover {
    background-color: #357abd;
  }
  #builtAll {
    font-size: 18px;
    width: 50%;
    min-width: 300px;
    height: auto;
    min-height: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: #fff;
    box-sizing: border-box;
    resize: both;
    font-family: inherit;
    color: #222;
    white-space: pre-wrap;
    margin-top: 8px;
  }
  #widthCalc {
    position: absolute;
    visibility: hidden;
    white-space: nowrap;
    font-size: 16px;
    font-family: inherit;
    padding: 6px 8px;
    border: 1px solid transparent;
    box-sizing: content-box;
  }
  .shirt-iep-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }
  .shirt-iep-container input[type="text"] {
    min-width: 17ch;
    max-width: 17ch;
  }
  .shirt-iep-separator {
    user-select: none;
    font-weight: bold;
    font-size: 18px;
  }
  #sessionDate {
    min-width: 17ch;
    max-width: 17ch;
  }
  .lineBreakBtn {
    background-color: #4a90e2;
    margin-left: 6px;
    padding: 6px 10px;
    font-size: 16px;
    border-radius: 4px;
  }
  .lineBreakBtn:hover {
    background-color: #666;
  }
  #copyBtn {
    background-color: #4a90e2;
    margin-left: 10px;
    margin-top: 8px;
  }
  #copyBtn:hover {
    background-color: #1e7e34;
  }
</style>
</head>
<body>

<div class="shirt-iep-container" aria-label="Shirt Number, IEP Group Number, and Date">
  <input id="shirtNumber" type="text" placeholder="Shirt Number" aria-label="Shirt Number" autocapitalize="off" />
  <input id="iepGroupNumber" type="text" placeholder="IEP Group Number" aria-label="IEP Group Number" autocapitalize="off" />
  <input id="sessionDate" type="text" placeholder="Date" aria-label="Date (optional)" autocapitalize="off" />
  <button id="buildHeaderBtn" title="Build Header">Build</button>
</div>

<div class="builder-section" aria-label="Sentence builder">
  <h2>Sentence:</h2>
  <input id="adverb1" type="text" placeholder="adverb" aria-label="Adverb 1" autocapitalize="off" />
  <input id="noun" type="text" placeholder="noun" aria-label="Noun" autocapitalize="off" />
  <input id="negation" type="text" placeholder="negation" aria-label="Negation" autocapitalize="off" />
  <input id="verb" type="text" placeholder="verb" aria-label="Verb" autocapitalize="off" />
  <input id="adverb2" type="text" placeholder="adverb" aria-label="Adverb 2" autocapitalize="off" />
  <input id="object" type="text" placeholder="object" aria-label="Object" autocapitalize="off" />
  <input id="subjectComplement" type="text" placeholder="subject complement" aria-label="Subject Complement" autocapitalize="off" />
  <input id="adverb3" type="text" placeholder="adverb" aria-label="Adverb 3" autocapitalize="off" />
  <input id="punctuation" type="text" placeholder=".,!" maxlength="1" aria-label="Punctuation" autocapitalize="off" />
  <input id="joiner" type="text" placeholder="joiner" aria-label="Joiner" autocapitalize="off" />
  <button id="buildBtn" title="Add on same line">Build on same line</button>
  <button class="lineBreakBtn" title="Add on next line">Build on next line</button>
</div>

<div class="builder-section" aria-label="Yes/No question builder">
  <h2>Yes/No Question:</h2>
  <input id="auxVerb" type="text" placeholder="be/do/can/have" aria-label="Helping or Be verb" autocapitalize="off" />
  <input id="auxSubject" type="text" placeholder="subject" aria-label="Subject" autocapitalize="off" />
  <input id="auxAdverbBeforeVerb" type="text" placeholder="adverb" aria-label="Adverb before verb" autocapitalize="off" />
  <input id="auxVerb2" type="text" placeholder="verb" aria-label="Verb" autocapitalize="off" />
  <input id="auxObject" type="text" placeholder="object" aria-label="Object" autocapitalize="off" />
  <input id="auxSubjectComplement" type="text" placeholder="subject complement" aria-label="Subject complement" autocapitalize="off" />
  <input id="auxAdverb" type="text" placeholder="adverb" aria-label="Adverb" autocapitalize="off" />
  <input id="auxQM" type="text" placeholder="?" maxlength="1" aria-label="Question mark" style="width: 2ch; text-align:center;" autocapitalize="off" />
  <button id="buildYesNoQuestionBtn" title="Add Yes/No Question on same line">Build on same line</button>
  <button class="lineBreakBtn" title="Add Yes/No Question on next line">Build on next line</button>
</div>

<div class="builder-section" aria-label="WH question builder">
  <h2>WH- Question:</h2>
  <input id="whWord" type="text" placeholder="who/what/where/when/why/how" aria-label="WH word" autocapitalize="off" />
  <input id="whAdverbBeforeVerb" type="text" placeholder="adverb" aria-label="Adverb before verb" autocapitalize="off" />
  <input id="whHelpingVerb" type="text" placeholder="am/is/are/do/can/have" aria-label="Helping or be verb" autocapitalize="off" />
  <input id="whSubject" type="text" placeholder="subject" aria-label="Subject" autocapitalize="off" />
  <input id="whVerb" type="text" placeholder="verb" aria-label="Verb" autocapitalize="off" />
  <input id="whObject" type="text" placeholder="object" aria-label="Object" autocapitalize="off" />
  <input id="whSubjectComplement" type="text" placeholder="subject complement" aria-label="Subject complement" autocapitalize="off" />
  <input id="whAdverb" type="text" placeholder="adverb" aria-label="Adverb" autocapitalize="off" />
  <input id="whQM" type="text" placeholder="?" maxlength="1" aria-label="Question mark" style="width: 2ch; text-align:center;" autocapitalize="off" />
  <button id="buildWhQuestionBtn" title="Add WH Question on same line">Build on same line</button>
  <button class="lineBreakBtn" title="Add WH Question on next line">Build on next line</button>
</div>

<div style="display: flex; align-items: flex-start; gap: 10px; flex-wrap: wrap;">
  <h2>Rough Draft:</h2>
  <textarea id="builtAll" aria-label="Rough draft output"></textarea>
  <button id="copyBtn" title="Copy rough draft">Copy</button>
</div>

<span id="widthCalc" aria-hidden="true"></span>

<script>
  let headerBuilt = false;

  function adjustWidth(el) {
    const span = document.getElementById('widthCalc');
    span.style.font = window.getComputedStyle(el).font;
    span.textContent = el.value || el.placeholder || '';
    let width = span.offsetWidth + 20;
    if (width < 35) width = 35;
    el.style.width = width + 'px';
  }

  function clearInputs(ids) {
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.value = '';
        adjustWidth(el);
      }
    });
  }

  function joinParts(parts) {
    if (parts.length === 0) return '';
    let result = parts[0];
    for (let i = 1; i < parts.length; i++) {
      if (/^[.,!?]$/.test(parts[i])) {
        result += parts[i];
      } else {
        result += ' ' + parts[i];
      }
    }
    return result;
  }

  document.querySelectorAll('input[type="text"]').forEach(input => {
    adjustWidth(input);
    input.addEventListener('input', () => adjustWidth(input));
  });

  // UPDATED appendToBuiltAll function only
  function appendToBuiltAll(text, addLineBreak) {
    const built = document.getElementById('builtAll');
    if (built.value) {
      if (addLineBreak) {
        built.value += '\n' + text;
      } else {
        const lastChar = built.value[built.value.length - 1];
        if (lastChar === '\n') {
          built.value += text;
        } else {
          built.value += ' ' + text;
        }
      }
    } else {
      built.value = text;
    }
  }

  document.getElementById('buildHeaderBtn').addEventListener('click', () => {
    if (headerBuilt) return; // Only build header once
    const shirt = document.getElementById('shirtNumber').value.trim();
    const iep = document.getElementById('iepGroupNumber').value.trim();
    const date = document.getElementById('sessionDate').value.trim();

    let headerParts = [];
    if (shirt) headerParts.push(shirt);
    if (iep) headerParts.push(iep);
    if (date) headerParts.push(date);

    if (headerParts.length > 0) {
      const headerStr = headerParts.join(' | ');
      const built = document.getElementById('builtAll');
      if (built.value) {
        // Add two line breaks before and after the header line for blank line spacing
        built.value += '\n\n' + headerStr + '\n\n';
      } else {
        built.value = headerStr + '\n\n';
      }
      headerBuilt = true;
      document.getElementById('buildHeaderBtn').disabled = true;
    }
  });

  document.getElementById('buildBtn').addEventListener('click', () => {
    const inputs = [
      'adverb1', 'noun', 'negation', 'verb',
      'adverb2', 'object', 'subjectComplement', 'adverb3',
      'punctuation', 'joiner'
    ];
    let parts = inputs.map(id => document.getElementById(id).value.trim()).filter(v => v.length > 0);
    if (parts.length === 0) return;
    const sentence = joinParts(parts);
    appendToBuiltAll(sentence, false);
    clearInputs(inputs);
  });

  document.querySelectorAll('.lineBreakBtn').forEach(btn => {
    btn.addEventListener('click', () => {
      let section = btn.closest('.builder-section');
      if (!section) return;
      let inputs = [];

      if (section.querySelector('h2').textContent.startsWith('Sentence')) {
        inputs = [
          'adverb1', 'noun', 'negation', 'verb',
          'adverb2', 'object', 'subjectComplement', 'adverb3',
          'punctuation', 'joiner'
        ];
      } else if (section.querySelector('h2').textContent.startsWith('Yes/No')) {
        inputs = [
          'auxVerb', 'auxSubject', 'auxAdverbBeforeVerb', 'auxVerb2',
          'auxObject', 'auxSubjectComplement', 'auxAdverb', 'auxQM'
        ];
      } else if (section.querySelector('h2').textContent.startsWith('WH-')) {
        inputs = [
          'whWord', 'whAdverbBeforeVerb', 'whHelpingVerb', 'whSubject',
          'whVerb', 'whObject', 'whSubjectComplement', 'whAdverb', 'whQM'
        ];
      }

      let parts = inputs.map(id => document.getElementById(id).value.trim()).filter(v => v.length > 0);
      if (parts.length === 0) return;
      const sentence = joinParts(parts);

      appendToBuiltAll(sentence, true);
      clearInputs(inputs);
    });
  });

  document.getElementById('buildYesNoQuestionBtn').addEventListener('click', () => {
    const inputs = [
      'auxVerb', 'auxSubject', 'auxAdverbBeforeVerb', 'auxVerb2',
      'auxObject', 'auxSubjectComplement', 'auxAdverb', 'auxQM'
    ];
    let parts = inputs.map(id => document.getElementById(id).value.trim()).filter(v => v.length > 0);
    if (parts.length === 0) return;
    const sentence = joinParts(parts);
    appendToBuiltAll(sentence, false);
    clearInputs(inputs);
  });

  document.getElementById('buildWhQuestionBtn').addEventListener('click', () => {
    const inputs = [
      'whWord', 'whAdverbBeforeVerb', 'whHelpingVerb', 'whSubject',
      'whVerb', 'whObject', 'whSubjectComplement', 'whAdverb', 'whQM'
    ];
    let parts = inputs.map(id => document.getElementById(id).value.trim()).filter(v => v.length > 0);
    if (parts.length === 0) return;
    const sentence = joinParts(parts);
    appendToBuiltAll(sentence, false);
    clearInputs(inputs);
  });

  document.getElementById('copyBtn').addEventListener('click', () => {
    const built = document.getElementById('builtAll');
    built.select();
    document.execCommand('copy');
    alert('Copied to clipboard!');
  });
</script>

</body>
</html>
